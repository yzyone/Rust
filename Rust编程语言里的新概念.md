
# Rust编程语言里的新概念 #

原创2021-11-30 19:20·努力摆脱宿命的小猪仔
rust编程语言里的新概念，其实也不难理解，只不过是在大家熟悉的编程语言比如Java，Python等里的一些概念上给与了自己的解释以适应其编程理念。

让我们一起看看这些新概念可以和我们熟悉的编程语言的概念有的可比性，以便于我们去理解rust。



概念一，ownership拥有关系

我们看这个表达式

![](./imgs/6a158dcceeb54dba9709abe02789d6da.jfif)
Rust编程语言里的新概念

在其它编程语言里owner就叫做变量，owner和"value"就是赋值关系。

不过在Python里面，也有owner叫做标签。

现在rust里面owner和value就是拥有关系，value是属于owner的，这就便于rust更一步阐述在同一时间value只能属于owner的理念，这就避免了c语言编程，c++语言编程时候会出现的重复释放变量占用内存的double free错误。

概念二，scope范围

其它编程语言里同样有scope范围的概念，Java， c#等用{}来做一个scope范围，JavaScript也是，Python用:来开始一段scope。

owner一旦在一个scope里定义了，出了这个scope就会被清理，后面的程序代码也就不能使用这个owner了，这就避免出现Java里的变量逃逸现象。

概念三，move移动

我们知道浅拷贝和深拷贝的概念，浅拷贝在rust编程语言和move移动这个概念类似。但是move会把被拷贝的owner从栈里删除，这就确保ownership只能有一个。

![](./imgs/1a0a926e546545749df3e418c9e0de4d.jfif)
Rust编程语言里的新概念


深拷贝在rust里用clone方法实现。

对于直接存储在栈上的数据比如数值，布尔，字符占有的存储空间都有固定大小就没有深浅拷贝之分，也就不用move这个概念来描述这部分数据操作。

概念四，引用借用

对于move的owner我们该如何做才能不move呢，rust提供了引用的概念。引用并不是拥有，所以没有ownership，而是用借用borrow这个概念，如下图

![](./imgs/548ca787f67c41bcb3fff7c7799c356d.jfif)
Rust编程语言里的新概念

giveme借用了owner的值。借用的东西不能修改，这也符号rust的不可修改的默认规则。要想修改同样用mut修饰符就可以了，这又被称为可变引用，使用可变引用者被称为可变借用。这很好理解。

值得注意的是一个owner在同一个scope里只能被可变借用一次并且不能存在不可变借用。这就避免了对内存写数据的独占性，保持数据一致性，摒除了数据在多个借用者之间同步的弊端。

当然了如果在可变借用之前有借用但是借用又被转移了，也就相当于不存在这个借用了，可变借用自然是可以的。这同样没有违背上面提到的只能有一个可变借用的规则。

![](./imgs/c72ec208d01b47748e03da058387860c.jfif)
Rust编程语言里的新概念

结合上面的引用，scope，move的概念，rust能够确保类C语言里悬摆指针的错误。

![](./imgs/706658af07424305a8c4a3628ed3e0c3.jfif)
Rust编程语言里的新概念

上面示例第一个方法就是一个返回一个引用的情况，rust是在编译的时候禁止的，因为它会造成返回的引用所指的内存已经释放了，造成运行时错误。

第二个方法直接返回字符串就避免了空引用问题。

好了，还有更多概念，下期再见。